---
title: "Abundance_diversity_analysis"
author: "Asa Julien"
date: "November 30, 2016"
output: html_document
---
##analyzing abundance
```{r, echo=FALSE}
library(car)
library(nlme)
library(lattice)
library(MASS)
library(dplyr)

new.df = read.csv("C:\\users\\juliena\\desktop\\data\\drop net\\csv files\\Diversity_abundance.csv")
legare.net = read.csv("C:\\users\\juliena\\desktop\\data\\drop net\\csv files\\Legare.csv")
#species richness:
sp.rich = legare.net %>%
  group_by(Order) %>%
  summarise(length(unique(Species))) #doesn't include traps with zero...

test.x = lm(Abundance ~ Salinity + Temperature + CharlestonHeight + Treatment + Date + Treatment:Date, data = new.df) #Is this correct? Order matters for the aov function... salinity and temperature have to go first in order to be included in the model, why? log transformation +1 helps with residuals
summary(test.x)
anova(test.x)
Anova(test.x) #this may be the one to use... what is the difference between type i/ii/iii ss?
plot(test.x)


#Mixed effects model -- loses interaction between date and treatment. Also need tidal height, dO2, pH, and trap number perhaps
abundance.lme = lme(fixed = Abundance ~ Treatment + Salinity + Temperature + CharlestonHeight, random = ~1 | Date/Pairing, data = new.df)
summary(abundance.lme) #Residuals a little better when log transformed; salinity becomes less "important" when this happens
plot(abundance.lme)


#blocking by trap number--------------------------------------------------------------
block.trap <- aov(Abundance ~ Treatment + TrapNo, data = new.df)
summary(block.trap) #no effect of trap on abundance
plot(block.trap)


################## repeated measures anchovy (ancova...)

rep.anc <- aov(Abundance ~ Treatment * Date + Error(Pairing/Treatment), data = new.df) #or should just Error(pairing.count) be used?
summary(rep.anc)
plot(rep.anc)
#formula kind of from: 
#https://ww2.coastal.edu/kingw/statistics/R-tutorials/repeated.html
#also on:
#https://www.r-bloggers.com/two-way-anova-with-repeated-measures/

```

##individual species patterns
```{r, echo=FALSE}
spp.date = new.df %>%
  select(PalaemonetesPugio, FundulusHeteroclitus, CallinectesSapidus, LitopenaeusSetiferus, BairdiellaChrysoura, FundulusLuciae, PalaemonetesVulgaris, EvorthodusLyricus, GobiosomaBosc, CyprinodonVariegatus, LeiostomusXanthurus, AlpheusHeterochaelis)



```

d
##analyzing indices
```{r, echo=FALSE}


```

d
##end