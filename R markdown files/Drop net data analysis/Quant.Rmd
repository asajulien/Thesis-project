---
title: "Abundance and diversity analyses"
output: html_document
---
##Linear models
```{r echo=FALSE}
library(car)
library(nlme)
library(lattice)
library(MASS)
library(dplyr)
library(vegan)

#files
new_df <- read.csv("~/Documents/Ribbed mussel/Data/Drop net/CSV files/Diversity_abundance.csv")
new_df = new_df[new_df$Month != "March", ] #Just for the purposes of this analysis!
legare_net = read.csv("~/Documents/Ribbed mussel/Data/Drop net/CSV files/Legare.csv")

#models
test_x = lm(log(Abundance + 1) ~ Salinity + Temperature + CharlestonHeight + Treatment + Datecode + Pairing, data = new_df) 
summary(test_x)
plot(test_x)

test_y = lm(Richness ~ Salinity + Temperature + CharlestonHeight + Treatment + Datecode + Pairing, data = new_df) 
summary(test_y)
plot(test_y)

test_z = lm(Shannon ~ Salinity + Temperature + CharlestonHeight + Treatment + Datecode + Pairing, data = new_df) 
summary(test_z)
plot(test_z)

#Mixed effects model
abundance_lme = lme(fixed = Abundance ~ Treatment + Salinity + Temperature + CharlestonHeight, random = ~1 | Date/Pairing, data = new_df)
summary(abundance_lme) #Residuals a little better when log transformed; salinity becomes less "important" when this happens
anova(abundance_lme)
plot(abundance_lme)

```

##Multivariate community composition
```{r, echo = FALSE}
#Community composition and direct ordination (trying both RDA and CCA)
marsh = new_df[, c(seq(7, 17))] #All species except for A. heterochaelis

#rda analysis
marsh_rda = rda(sqrt(marsh) ~ Treatment + Temperature + Salinity + CharlestonHeight, data = new_df) #square root transformation makes treatment significant
marsh_rda
plot(marsh_rda)

anova(marsh_rda, by = 'margin')

#cca
marsh_cca = cca(marsh ~ Treatment + Temperature + Salinity + CharlestonHeight, data=new_df) #All rows have to be greater than zero
```

##NGS (no grass shrimp)
```{r, echo = FALSE}
new_df$abun_ngs = rowSums(new_df[, seq(8, 17)]) #no A. heterochaelis right now because of NAs

#abundance model
test_ngs = lm(log(abun_ngs + 1) ~ Salinity + Temperature + CharlestonHeight + Treatment + as.numeric(Date) + Pairing, data = new_df) 
summary(test_ngs)
plot(test_ngs)

#NGS rda analysis
marsh_ngs = new_df[, c(seq(8, 17))] #No P. pugio or A. heterochaelis
ngs_rda = rda(sqrt(marsh_ngs) ~ Treatment + Temperature + Salinity + CharlestonHeight, data = new_df) #square root transformation makes treatment significant
ngs_rda
plot(ngs_rda)

anova(marsh_rda, by = 'margin')
```



