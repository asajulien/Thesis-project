---
title: "Abundance and diversity analyses"
output: html_document
---
##Linear models
```{r echo=FALSE}
library(car)
library(nlme)
library(lattice)
library(MASS)
library(dplyr)
library(vegan)

#files
new_df <- read.csv("~/Documents/Ribbed mussel/Data/Drop net/CSV files/Diversity_abundance.csv")
new_df = new.df[new.df$Month != "March", ] #Just for the purposes of this analysis!
legare_net = read.csv("~/Documents/Ribbed mussel/Data/Drop net/CSV files/Legare.csv")

#models
test_x = lm(Abundance ~ Salinity + Temperature + CharlestonHeight + Treatment + as.numeric(Date) + Pairing, data = new_df) 
summary(test_x)
plot(test_x)

test_y = lm(Richness ~ Salinity + Temperature + CharlestonHeight + Treatment + as.numeric(Date) + Pairing, data = new_df) 
summary(test_y)
plot(test_y)

test_z = lm(Shannon ~ Salinity + Temperature + CharlestonHeight + Treatment + as.numeric(Date) + Pairing, data = new_df) 
summary(test_z)
plot(test_z)

#Mixed effects model
abundance_lme = lme(fixed = Abundance ~ Treatment + Salinity + Temperature + CharlestonHeight, random = ~1 | Date/Pairing, data = new_df)
summary(abundance_lme) #Residuals a little better when log transformed; salinity becomes less "important" when this happens
anova(abundance_lme)
plot(abundance_lme)

```

##Multivariate community composition
```{r, echo = FALSE}
#Community composition and direct ordination (trying both RDA and CCA)
marsh = new_df[, c(seq(7, 17))] #All species except for A. heterochaelis

#rda analysis
marsh_rda = rda(sqrt(marsh) ~ Treatment + Temperature + Salinity + CharlestonHeight, data=new_df) #square root transformation makes treatment significant
marsh_rda
plot(marsh_rda)

anova(marsh_rda, by='margin')

#cca
marsh_cca = cca(marsh ~ Treatment + Temperature + Salinity + CharlestonHeight, data=new_df) #All rows have to be greater than zero
```

##Differences between paired plot types
```{r}
diff_treat = new_df %>%
  group_by(Date, Pairing) %>%
  select(Date, Treatment, Pairing, Salinity, Temperature, CharlestonHeight, dO2, Abundance, Shannon, Simpson, InverseS, Richness, PalaemonetesPugio, FundulusHeteroclitus, CallinectesSapidus, LitopenaeusSetiferus, BairdiellaChrysoura, FundulusLuciae, PalaemonetesVulgaris, EvorthodusLyricus, GobiosomaBosc, CyprinodonVariegatus, LeiostomusXanthurus, AlpheusHeterochaelis) %>%
  summarise(mean(Temperature), mean(Salinity), mean(CharlestonHeight), mean(dO2), diff(Abundance), diff(Shannon), diff(Simpson), diff(InverseS), diff(Richness), diff(PalaemonetesPugio), diff(FundulusHeteroclitus), diff(CallinectesSapidus), diff(LitopenaeusSetiferus), diff(BairdiellaChrysoura), diff(FundulusLuciae), diff(PalaemonetesVulgaris), diff(EvorthodusLyricus), diff(GobiosomaBosc), diff(CyprinodonVariegatus), diff(LeiostomusXanthurus), diff(AlpheusHeterochaelis)) #Note: "Mean" for temp, sal, tidal height, and dO2 is okay to use since on a given day/pairing, the mean is equal to both the values that contribute to it (see new.df)

colnames(diff_treat) = c("Date", "Pairing", "Temperature", "Salinity", "CharlestonHeight", "dO2", "Abundance", "Shannon", "Simpson", "InverseS", "Richness", "PalaemonetesPugio", "FundulusHeteroclitus", "CallinectesSapidus", "LitopenaeusSetiferus", "BairdiellaChrysoura", "FundulusLuciae", "PalaemonetesVulgaris", "EvorthodusLyricus", "GobiosomaBosc", "CyprinodonVariegatus", "LeiostomusXanthurus", "AlpheusHeterochaelis")

#This is all Spartina - Mussels (don't know how to change that). So, the more negative it is, the more there are around mussel patches.

t_abun = t.test(diff_treat$Abundance)
t.abun

```

