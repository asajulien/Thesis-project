---
title: "Ashley grid surveys"
author: "Asa Julien"
date: "February 15, 2017"
output: html_document
---
##Ashley grid I
```{r pressure, echo=FALSE}
library(lattice)
library(ggplot2)
library(rms)
library(pscl)

ashgrid = read.csv(("C:\\Users\\juliena\\Desktop\\Data\\Elevation\\CSV files\\Ash_grids.csv"))

ashgrid$Mussel.presence = ifelse(ashgrid$Mussel.presence == 'Present', 1, 0)

#All together
ashglm = glm(Mussel.presence ~ Elevation * Block, family = binomial, data = ashgrid)
summary(ashglm)
plot(ashglm)

full_mod = ashglm
main_mod = update(full_mod, . ~ . - Elevation:Block)
elev_mod = update(main_mod, . ~ . - Block)
elev_mod2 = update(elev_mod, . ~ . + I(Elevation^2))
elev_mod3 = update(elev_mod2, . ~ . + I(Elevation^3))
elev_mod4 = update(elev_mod2, . ~ . + Block)
elev_mod5 = update(elev_mod2, . ~ . + Block + Elevation:Block)

anova(full_mod, main_mod, elev_mod, test='LRT')
AIC(full_mod, main_mod, elev_mod)

anova(elev_mod, elev_mod2, elev_mod4, elev_mod5, test='LRT')
AIC(elev_mod, elev_mod2, elev_mod4, elev_mod5) #model 4 is the best

#add salinity back in - plot both
plot(elev_mod2)
plot(elev_mod4)
summary(elev_mod4)

#model fits; pseudo r^2
full_r2 = pR2(full_mod)
main_r2 = pR2(main_mod)
mod_r2 = pR2(elev_mod)
mod2_r2 = pR2(elev_mod2)
mod4_r2 = pR2(elev_mod4)
mod5_r2 = pR2(elev_mod5)

#plotting data and values predicted by models
new_data = data.frame(Elevation = seq(0, 1, length.out = 50), Block = rep(c("20-25"), each = 50))
new_data2 = data.frame(Elevation = seq(0, 1, length.out = 50), Block = rep(c("15-20"), each = 50))
new_data3 = data.frame(Elevation = seq(0, 1, length.out = 50), Block = rep(c("10-15"), each = 50))
new_data4 = data.frame(Elevation = seq(0, 1, length.out = 50), Block = rep(c("5-10"), each = 50))

plot(Mussel.presence ~ Elevation, data=ashgrid, pch = 20, col = ashgrid$Block, xlab = "Elevation (m)", ylab = "Probability of Geukensia demissa occurrence")
legend(-0.1, 1, unique(ashgrid$Block), col = c("green", "red", "black", "blue"), pch = 20)
text(-0.02, 0.78, "Salinity (ppt)")

lines(new_data$Elevation, predict(elev_mod4, newdata=new_data, type='response'),
      col='green')
lines(new_data2$Elevation, predict(elev_mod4, newdata=new_data2, type='response'),
      col='red')
lines(new_data3$Elevation, predict(elev_mod4, newdata=new_data3, type='response'),
      col='black')
lines(new_data4$Elevation, predict(elev_mod4, newdata=new_data4, type='response'),
      col='blue')

lines(new_data$Elevation, predict(elev_mod, newdata=new_data, type='response'),
      col='purple')
lines(new_data$Elevation, predict(elev_mod2, newdata=new_data, type='response'),
      col='pink')

ash_plot = ggplot(ashgrid, aes(x = Elevation, y = Mussel.presence))
ash_plot + geom_point(aes(colour = Block))

#Individual salinity blocks
ashglm.i = glm(Mussel.presence[Grid.ID == "Ash 1"] ~ Elevation[Grid.ID == "Ash 1"], family = binomial, data = ashgrid)
summary(ashglm.i)

ashglm.ii = glm(Mussel.presence[Grid.ID == "Ash 2"] ~ Elevation[Grid.ID == "Ash 2"], family = binomial, data = ashgrid)
summary(ashglm.ii)

ashglm.iii = glm(Mussel.presence[Grid.ID == "Ash 3"] ~ Elevation[Grid.ID == "Ash 3"], family = binomial, data = ashgrid)
summary(ashglm.iii)

ashglm.iv = glm(Mussel.presence[Grid.ID == "Ash 4"] ~ Elevation[Grid.ID == "Ash 4"], family = binomial, data = ashgrid)
summary(ashglm.iv)

##Figures 
xyplot(Mussel.presence[Grid.ID == "Ash 1"] ~ Elevation[Grid.ID == "Ash 1"], data = ashgrid)
xyplot(Mussel.presence[Grid.ID == "Ash 2"] ~ Elevation[Grid.ID == "Ash 2"], data = ashgrid)
xyplot(Mussel.presence[Grid.ID == "Ash 3"] ~ Elevation[Grid.ID == "Ash 3"], data = ashgrid)
xyplot(Mussel.presence[Grid.ID == "Ash 4"] ~ Elevation[Grid.ID == "Ash 4"], data = ashgrid)
xyplot(Mussel.presence[Grid.ID == "Ash 5"] ~ Elevation[Grid.ID == "Ash 5"], data = ashgrid)
```


##Elevation above MHW
```{r pressure, echo=FALSE}

ashgrid$Mussel.presence = ifelse(ashgrid$Mussel.presence == 'Present', 1, 0)

#All together - something weird goes on when above chunk is executed, but the code below will work
ashglm_mhw = glm(Mussel.presence ~ MHW * Block, family = binomial, data = ashgrid)
summary(ashglm_mhw)
plot(ashglm_mhw)

full_mhw = ashglm_mhw
main_mhw = update(full_mhw, . ~ . - MHW:Block)
elev_mhw = update(main_mhw, . ~ . - Block)
elev_mhw2 = update(elev_mhw, . ~ . + I(MHW^2))
elev_mhw3 = update(elev_mhw2, . ~ . + I(MHW^3))
elev_mhw4 = update(elev_mhw2, . ~ . + Block)
elev_mhw5 = update(elev_mhw2, . ~ . + Block + MHW:Block)

anova(full_mhw, main_mhw, elev_mhw, test='LRT')
AIC(full_mhw, main_mhw, elev_mhw)

anova(elev_mhw, elev_mhw2, elev_mhw4, elev_mhw5, test='LRT')
AIC(elev_mhw, elev_mhw2, elev_mhw4, elev_mhw5) #model 4 is the best

#add salinity back in - plot both
plot(elev_mhw2)
plot(elev_mhw4)
summary(elev_mhw4)

#model fits; pseudo r^2
pR2(full_mhw)
pR2(main_mhw)
pR2(elev_mhw)
pR2(elev_mhw2)
pR2(elev_mhw4)
pR2(elev_mhw5)

#plotting data and values predicted by models
MHW_data = data.frame(MHW = seq(-1.2, .2, length.out = 50), Block = rep(c("20-25"), each = 50))
MHW_data2 = data.frame(MHW = seq(-1.2, .2, length.out = 50), Block = rep(c("15-20"), each = 50))
MHW_data3 = data.frame(MHW = seq(-1.2, .2, length.out = 50), Block = rep(c("10-15"), each = 50))
MHW_data4 = data.frame(MHW = seq(-1.2, .2, length.out = 50), Block = rep(c("5-10"), each = 50))

plot(Mussel.presence ~ MHW, data=ashgrid, pch = 20, col = ashgrid$Block, xlab = "Elevation above MHW (m)", ylab = "Probability of Geukensia demissa occurrence")
legend(-1.1, 1, unique(ashgrid$Block), col = c("green", "red", "black", "blue"), pch = 20)
text(-1.03, 0.78, "Salinity (ppt)")

lines(MHW_data$MHW, predict(elev_mhw4, newdata=MHW_data, type='response'),
      col='green')
lines(MHW_data2$MHW, predict(elev_mhw4, newdata=MHW_data2, type='response'),
      col='red')
lines(MHW_data3$MHW, predict(elev_mhw4, newdata=MHW_data3, type='response'),
      col='black')
lines(MHW_data4$MHW, predict(elev_mhw4, newdata=MHW_data4, type='response'),
      col='blue')

lines(MHW_data$MHW, predict(elev_mhw, newdata=new_data, type='response'),
      col='purple')
lines(MHW_data$MHW, predict(elev_mhw2, newdata=new_data, type='response'),
      col='pink')

```

d
