---
title: "Ashley grid surveys"
author: "Asa Julien"
date: "February 15, 2017"
output: html_document
---
##Ashley grid I
```{r pressure, echo=FALSE}
library(lattice)
library(ggplot2)

ashgrid = read.csv(("C:\\Users\\juliena\\Desktop\\Data\\Elevation\\CSV files\\Ash_grids.csv"))

ashgrid$Mussel.presence = ifelse(ashgrid$Mussel.presence == 'Present', 1, 0)

#All together
ashglm = glm(Mussel.presence ~ Elevation * Block, family = binomial, data = ashgrid)
summary(ashglm)
plot(ashglm)

full_mod = ashglm
main_mod = update(full_mod, . ~ . - Elevation:Block)
elev_mod = update(main_mod, . ~ . - Block)
elev_mod2 = update(elev_mod, . ~ . + I(Elevation^2))
elev_mod3 = update(elev_mod2, . ~ . + I(Elevation^3))
elev_mod4 = update(elev_mod2, . ~ . + Block)
elev_mod5 = update(elev_mod2, . ~ . + Block + Elevation:Block)

anova(full_mod, main_mod, elev_mod, test='LRT')
AIC(full_mod, main_mod, elev_mod)

anova(elev_mod, elev_mod2, elev_mod4, elev_mod5, test='LRT')
AIC(elev_mod, elev_mod2, elev_mod4, elev_mod5) #model 4 is the best?

#add salinity back in - plot both
plot(elev_mod2)
plot(elev_mod4)
summary(elev_mod4)

new_data = data.frame(Elevation = seq(0, .8, length.out = 50), Block = rep(c("20-25"), each = 50))
new_data2 = data.frame(Elevation = seq(0, .8, length.out = 50), Block = rep(c("15-20"), each = 50))
new_data3 = data.frame(Elevation = seq(0, .8, length.out = 50), Block = rep(c("10-15"), each = 50))

plot(Mussel.presence ~ Elevation, data=ashgrid, pch = 20, col = ashgrid$Block, xlab = "Elevation (m)", ylab = "Geukensia demissa presence")
legend(-0.1, 1, unique(ashgrid$Block), col = c("green", "red", "black"), pch = 20)

lines(new_data$Elevation, predict(elev_mod, newdata=new_data, type='response'),
      col='blue')
lines(new_data$Elevation, predict(elev_mod2, newdata=new_data, type='response'),
      col='pink')
lines(new_data$Elevation, predict(elev_mod4, newdata=new_data, type='response'),
      col='green')
lines(new_data2$Elevation, predict(elev_mod4, newdata=new_data2, type='response'),
      col='red')
lines(new_data3$Elevation, predict(elev_mod4, newdata=new_data3, type='response'),
      col='black')

ash_plot = ggplot(ashgrid, aes(x = Elevation, y = Mussel.presence))
ash_plot + geom_point(aes(colour = Block))

#Individual salinity blocks
ashglm.i = glm(Mussel.presence[Grid.ID == "Ash 1"] ~ Elevation[Grid.ID == "Ash 1"], family = binomial, data = ashgrid)
summary(ashglm.i)

ashglm.ii = glm(Mussel.presence[Grid.ID == "Ash 2"] ~ Elevation[Grid.ID == "Ash 2"], family = binomial, data = ashgrid)
summary(ashglm.ii)

ashglm.iii = glm(Mussel.presence[Grid.ID == "Ash 3"] ~ Elevation[Grid.ID == "Ash 3"], family = binomial, data = ashgrid)
summary(ashglm.iii)

ashglm.iv = glm(Mussel.presence[Grid.ID == "Ash 4"] ~ Elevation[Grid.ID == "Ash 4"], family = binomial, data = ashgrid)
summary(ashglm.iv)

##Figures 
xyplot(Mussel.presence[Grid.ID == "Ash 1"] ~ Elevation[Grid.ID == "Ash 1"], data = ashgrid)
xyplot(Mussel.presence[Grid.ID == "Ash 2"] ~ Elevation[Grid.ID == "Ash 2"], data = ashgrid)
xyplot(Mussel.presence[Grid.ID == "Ash 3"] ~ Elevation[Grid.ID == "Ash 3"], data = ashgrid)
xyplot(Mussel.presence[Grid.ID == "Ash 4"] ~ Elevation[Grid.ID == "Ash 4"], data = ashgrid)
xyplot(Mussel.presence[Grid.ID == "Ash 5"] ~ Elevation[Grid.ID == "Ash 5"], data = ashgrid)
```


S
